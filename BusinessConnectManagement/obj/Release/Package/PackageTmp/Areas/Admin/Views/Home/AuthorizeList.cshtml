@model IEnumerable<BusinessConnectManagement.Models.VanLangUser>

@{
    ViewBag.Title = "List Authorized User";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<section class="list">
    <h1 class="list-heading">Danh sách đăng nhập</h1>
    <div class="list-table">
        <table id="table_id" class="display">

            <thead>
                <tr>
                    <th>Tên</th>
                    <th>Email</th>
                    <th>Chức vụ</th>
                    <th>Trạng thái</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td> @Html.DisplayFor(modelItem => item.FullName)</td>
                        <td> @Html.DisplayFor(modelItem => item.Email)</td>
                        <td> @Html.DisplayFor(modelItem => item.Role.Role_Name)</td>
                        <td>
                            @item.Status.Status1
                        </td>
                        <td class="text-center">
                            <button class="btn btn-action btn--update" onclick="loadEditUser('@item.Email', '@item.FullName')">Cập nhật</button>
                        </td>
                    </tr>
                }
            </tbody>

        </table>
    </div>
</section>

<form action="@Url.Action("Edit", "Home")" method="post" class="form" id="updateForm">
    <input name="email" id="email" hidden />
    <div class="form-container" id="editUserRole">
        <i class="form-icon fas fa-times-circle"></i>
        <h1 class="form-heading">Cập nhật vai trò</h1>
        <div class="form-group">
            <label for="email" class="form-label">Họ và Tên</label>
            <input id="name" class="form-input" autocomplete="off" disabled />
        </div>
        <div class="edit">
            <div class="form-group">
                <label for="role" class="form-label">Vai trò</label>
                <select name="RoleId" id="select-list-e-user-role" class="form-select">
                    @foreach (var role in ViewBag.RoleList)
                    {
                        <option value=@role.ID>@role.Role_Name</option>
                    }
                </select>
            </div>
        </div>

        <div class="editStatus">
            <div class="form-group">
                <label for="status" class="form-label">Vai trò</label>
                <select name="StatusId" id="select-status" class="form-select">
                    @foreach (var status in ViewBag.StatusList)
                    {
                        <option value=@status.ID>@status.Status1</option>
                    }
                </select>
            </div>
        </div>
        <div class="form-group">
            <button type="submit" class="form-button">Lưu</button>
        </div>
    </div>
</form>

@section Scripts {

    <script type="text/javascript">
        function loadEditUser(email,name) {
            let formUpdate = document.getElementById("updateForm");
            formUpdate.classList.add('is-appear')
            document.getElementById('name').value = name;
            document.getElementById('email').value = email;
            $(".form-icon").on("click", function () {
                formUpdate.classList.remove('is-appear')
            })
            let url = `@Url.Action("EditUserRole")`
            $.ajax({
                type: "GET",
                url: `${url}`,
                data: { email: email},
                    dataType: "json",
                success: function (data) {
                    $("#select-list-e-user-role").val(data.RoleId);
                        $("#select-status").val(data.StatusId);
                    },
                    error: function (err) {
                        alert('error')
                    }
                })
        }
    </script>
}