@using BusinessConnectManagement.Models;
@{
    BCMEntities db = new BCMEntities();
    var count = 0;
    int BusinessID = Convert.ToInt16(Session["BusinessID"]);
    var curBusiness = db.BusinessUsers.Where(x => x.ID == BusinessID).FirstOrDefault();
    if(curBusiness.Status_ID == 2)
    {

        if (Request.Cookies["ASP.NET_SessionId"] != null)
        {

            HttpCookie httpCookie = Response.Cookies["ASP.NET_SessionId"];
            httpCookie.Expires = DateTime.Now.AddDays(-1);
            Response.Cookies.Add(httpCookie);
        }
       
        TempData["message"] = "Tài khoản của bạn đang bị khóa. Vui lòng liên hệ Khoa CNTT để được hỗ trợ.";
        TempData["messageType"] = "warning";
        Response.Redirect("~/doanh-nghiep/dang-nhap");
    }
    ViewBag.Notifications = db.Notifications.Where(x => x.Business_ID == BusinessID).OrderByDescending(x=>x.Date).ToList();
    count = db.Notifications.Where(x => x.Business_ID == BusinessID && x.IsRead == false).Count();

}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewBag.Title</title>
    <link rel="stylesheet"
          href="https://site-assets.fontawesome.com/releases/v5.15.4/css/all.css" />
    @*<link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">*@
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="~/assets/css/jquery2.dataTables.min.css" rel="stylesheet" />

    <link href="~/assets/css/grid.css" rel="stylesheet" />
    <link href="~/assets/css/reset.css" rel="stylesheet" />
    <link href="~/assets/css/global.css" rel="stylesheet" />
    <link href="~/assets/css/toast.css" rel="stylesheet" />
    <link href="~/assets/css/layout.css" rel="stylesheet" />
    <link href="~/assets/css/style.css" rel="stylesheet" />
    <link href="~/assets/css/form.css" rel="stylesheet" />
    <link href="~/assets/css/statistic.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="~/Content/bootstrap-chosen.css" rel="stylesheet" />
    <link href="~/assets/css/toast.css" rel="stylesheet" />
    <link rel="shortcut icon" href="~/assets/images/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="wrap" id="wrap">
        <section class="menu">

            <div class="menu-logo">
                <a href="@Url.Action("Index", "BusinessHome")" class="menu-link">
                    <img src="~/assets/images/logoVL.png"
                         alt=""
                         class="menu-image" />
                    <span class="menu-title">Business Connection Management</span>
                </a>
                <i class="fal fa-long-arrow-right" id="menu-icon"></i>
            </div>
            <ul class="menu-list">
                <li class="menu-item">
                    <a href="@Url.Action("Index", "InternViews")" class="menu-feature">
                        <i class="menu-icon fal fa-id-card"></i>
                        <span class="menu-text">Ứng tuyển</span>
                    </a>
                    <span class="menu-tooltip">Ứng tuyển</span>
                </li>
                <li class="menu-item">
                    <a href="@Url.Action("Index", "InternshipResults")" class="menu-feature">
                        <i class="menu-icon fal fa-id-card-alt"></i>
                        <span class="menu-text">Thực Tập</span>
                    </a>
                    <span class="menu-tooltip">Thực Tập</span>
                </li>
            </ul>
        </section>
        <div class="content">
            <nav class="nav">
                <div class="nav-wrap">
                    <div class="notification">
                        <a href="#">
                            <div class="notBtn" href="#">
                                <!--Number supports double digets and automaticly hides itself when there is nothing between divs -->
                                @if (count != 0)
                                {
                                    <div class="number" id="numNoti">
                                        @count
                                    </div>
                                }
                                <i class="fas fa-bell bell-icon"></i>
                                <div class="box">
                                    <div class="display">
                                        <div class="cont">
                                            <!-- Fold this div and try deleting evrything inbetween -->
                                            @foreach (var item in ViewBag.Notifications)
                                            {
                                                <div class="sec new">
                                                        <div class="txt">@item.Message</div>
                                                        <div class="txt sub">@item.Date</div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    <span class="nav-role">@Session["BusinessName"]</span>
                    <div class="nav-avatar">
                        <img src="~/assets/images/avatarAdmin.png"
                             alt=""
                             class="nav-image" />
                        <div class="nav-account-list">
                            <a href="@Url.Action("Logout", "Auth")" class="nav-account-item">Đăng xuất</a>
                        </div>
                    </div>
                </div>
            </nav>

            @RenderBody()


        </div>
    </div>
    <div id="icon">
        <i class="fal fa-bars"></i>
    </div>
    <div id="moveTop">
        <a href="#wrap" class="moveTop-link"><i class="fal fa-arrow-up"></i><a>
    </div>
    <section class="footer">&copy; Phần mềm BCM thuộc về khoa CNTT, Trường Đại học Văn Lang</section>

<script src="~/assets/js/index.js"></script>
<script src="~/assets/js/admin.js"></script>
<script src="~/Scripts/jquery-3.4.1.js"></script>
<script src="~/Scripts/jquery.validate.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script src="~/Scripts/chosen.jquery.js"></script>
<script src="~/assets/js/datatable/dataTable.min.js"></script>

<script>
    $(".notBtn").hover(function () {
            const url = "@Url.Action("ChangeNotification","BusinessHome")"
            $.ajax({
                url: url,
                success: function (res) {
                    $("#numNoti").text("");
                }
            })
        })
    $(function () {
        $("#table_id_filter").prepend($("#filterEvent")).clone();
    });

    let formUpdate = document.getElementById("updateForm");
    let icon = document.querySelector(".form-icon");
    let isHide = "is-hide";
    let isAppear = "is-appear";

    $(".form-icon").on("click", function () {
        formUpdate.classList.remove(isAppear);
    })
    $(function () {
        const toast = document.querySelector(".toast");
        setTimeout(() => {
            toast.remove();
        }, 3000);

    });
    function remove() {
        let toast = document.querySelector(".toast");
        document.querySelector(".toast-right").addEventListener("click", () => {
            toast.remove();
        });

    }
    $('.btn--cancel').on('click', function () {
        $('#updateForm').removeClass('is-appear')
    });

</script>
@RenderSection("scripts", required: false)
</body>


