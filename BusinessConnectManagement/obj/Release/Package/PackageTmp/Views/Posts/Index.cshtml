@model PagedList.IPagedList<BusinessConnectManagement.Models.Post>
@using PagedList.Mvc;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<main>
    <div id="bg-form">
        <img class="img-responsive rounded" src="~/assets/User/assets/images/slider.jpg" alt="macOS Yosemite Wallpaper">
        <div class="form">
            <div class="container">
                <form id="Search" action="">
                    <div class="columns">
                        <div class="column col-3 col-sm-12 col-md-6 col-xl-3 mb10 px-0">
                            <div class="form-group">
                                <input class="form-input" type="text" id="searchString" name="SearchString" placeholder="Tìm việc">
                            </div>
                        </div>
                        <div class="column col-3 col-sm-12 col-md-6 col-xl-3 mb10 px-0">
                            <div class="form-group">
                                <select id="Form" name="Form" class="form-select">
                                    <option value="">Chọn Hình Thức Thực Tập</option>
                                    <option value="Online">Online</option>
                                    <option value="Offline">Offline</option>
                                </select>
                            </div>
                        </div>
                        <div class="column col-3 col-sm-12 col-md-6 col-xl-3 mb10 px-0">
                            <div class="form-group">
                                <select name="Major" class="form-select">
                                    <option value="">Chọn Chuyên Nghành</option>
                                    @foreach (var item in ViewBag.Major)
                                    {
                                        <option value="@item.Major1">@item.Major1</option>
                                    }

                                </select>
                            </div>
                        </div>

                        <div class="column col-3 col-sm-12 col-md-6 col-xl-3 mb10 px-0">
                            <button class="btn btn-error w100" onclick="insertParam()">Tim Kiem</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>



    <section id="job">
        <div class="container">
            <div class="title-home">
                <h3>Công việc nổi bật</h3>

            </div>

            <div class="columns pt30">
                @foreach (var item in Model)
                {
                    /*string str1 = item.DueDate;
                    DateTime d = DateTime.ParseExact(str1, "yyyy/MM/dd HH:mm:ss", CultureInfo.InvariantCulture);*/
                    <div class="column col-6 col-sm-12 col-md-12 col-xl-6 mb10 wow bounce" data-wow-delay="0.5s">
                        <a href="@Url.Action("Details", "Posts",  new { id=item.ID })">
                            <div class="item d-flex align-middle">
                                <img src="@Url.Content("~/Uploads/Images/" + item.BusinessUser.BusinessLogo)" alt="image-job">
                                <div class="content">
                                    <div class="d-flex align-middle justify-between mb-2">
                                        <h3 class="text-h4 bold-6 mb-0 ellipsis"> @item.Title</h3>
                                        <div class="chip bg-error">
                                            <small class="bold-6">Nổi bật</small>
                                        </div>
                                    </div>
                                    <p class="bold-6 text-italic mb-2"> @item.BusinessUser.BusinessName</p>
                                    <div class="desc d-flex align-middle mb-2">
                                        <span class="mb-0 mr10 text-success">
                                            @if (item.Major_ID != null)
                                            {
                                                <i class="fa-solid fa-tag"></i> @item.Major.Major1
                                            }
                                            else
                                            {

                                            }
                                        </span>
                                        <span class="mb-0 mr10 text-warning">
                                            <i class="fa-solid fa-tag"></i> @item.Form
                                        </span>

                                    </div>
                                    <div class="desc d-flex align-middle mb-2">
                                        <span class="mb-0 mr10 text-muted">
                                            <i class="fa-solid fa-location-dot"></i> @item.BusinessUser.Address
                                        </span>
                                    </div>
                                    <p class="text-primary bold-6">
                                        <i>Hạn nộp: @item.DueDate</i>
                                        <i style="float:right">Lượt ứng tuyển: @item.Registrations.Count()</i>
                                    </p>

                                </div>
                            </div>
                        </a>

                    </div>
                }
            </div>
            <div class="pagination-container" style="float: right">
                Trang @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) / @Model.PageCount
            </div>
            <div class="center">
                <div class="pagination-container">
                    @Html.PagedListPager(Model, page => Url.Action("Index", new { page }))
                </div>
            </div>
        </div>
    </section>

</main>

@section Scripts {
    <script>
        function insertParam() {
            searchString = document.getElementById("searchString").value;
            form = document.getElementById("Form").value;
            console.log(searchString)

            const actionUrl = `@Url.Action("Search", "Posts")`;
            console.log(actionUrl)
            $('#Search').attr('action', `${actionUrl}`)
        }
        $(document).ready(function () {
            $('body').on('click', '.pagination-container a', function (e) {
                e.preventDefault(); // prevent the default link behavior
                var url = $(this).attr('href');
                var page = url.split('=')[1]; // Lấy số trang từ URL
                $.get(url, function (data) {
                    var newContent = $(data).find('#job').html();
                    $('#job').html(newContent);
                    $('html, body').animate({ scrollTop: $('#job').offset().top - 73 }, 'slow');
                    history.pushState({}, '', '/tin-tuyen-dung?page=' + page); // Thay đổi URL hiển thị trên thanh địa chỉ trình duyệt
                });
            });
        });

    </script>
}