
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    <link href="~/assets/User/assets/css/form.css" rel="stylesheet" />
}
@if (TempData["message"] != null)
{
    <script>
        toastr.@(TempData["messageType"])('@TempData["message"]','Thông Báo');
    </script>
}
<main>
    <div id="bg-bread">
        <div class="overlay-bread"></div>
        <div class="container">
            <div class="left">
                <div class="d-flex align-middle mb10">
                    <h3 class="text-h2">Danh Sách Thực Tập</h3>
                </div>

            </div>
        </div>
    </div>

    <section class="mt30">
        <div class="container mb30">
            <table id="table1" class="display" width="100%">
                <thead>
                    <tr>
                        <th class="text-center">STT</th>
                        <th class="text-center">Tên Doanh Nghiệp</th>
                        <th class="text-center">Vị Trí</th>
                        <th class="text-center">Trạng Thái</th>
                        <th class="text-center" width="26%">Thông Tin</th>
                    </tr>
                </thead>
            </table>
        </div>
    </section>
    @*-------------------confirm---------------------*@
    <form class="form" id="updateForm" method="post">
        <div class="form-container">
            <h1 class="form-heading">Kết Quả Thực Tập</h1>
            <div class="row">
                <div class="columnn">
                    <div class="form-group">
                        <label for="comment" class="form-label">Vị trí thực tập</label>
                        <input name="Position" id="Position" class="form-input" autocomplete="off" disabled />
                    </div>
                    <div class="form-group">
                        <label for="comment" class="form-label">Email giáo viên</label>
                        <input name="Email_Mentor" id="email" class="form-input" autocomplete="off" disabled />
                    </div>
                    <div class="form-group">
                        <label for="comment" class="form-label">Điểm giáo viên</label>
                        <input list="" name="MentorPoint" id="mentorPoint" class="form-input" disabled />
                    </div>
                    <div class="form-group">
                        <label for="comment" class="form-label">Nhận xét của giáo viên</label>
                        <input list="" name="MentorComment" id="mentorComment" class="form-input" disabled />
                    </div>
                </div>
                <div class="columnn">
                    <div class="form-group">
                        <label for="comment" class="form-label">Trạng thái thực tập</label>
                        <input list="" name="Status" id="status" class="form-input" disabled />
                    </div>
                    <div class="form-group">
                        <label for="comment" class="form-label">Tên doanh nghiệp</label>
                        <input list="" name="Businessname" id="businessname" class="form-input" disabled />
                    </div>
                    <div class="form-group">
                        <label for="comment" class="form-label">Điểm doanh nghiệp</label>
                        <input list="" name="BusinessPoint" id="businessPoint" class="form-input" disabled />
                    </div>
                    <div class="form-group">
                        <label for="comment" class="form-label">Nhận xét của doanh nghiệp</label>
                        <input list="" name="BusinessComment" id="businessComment" class="form-input" disabled />
                    </div>
                </div>
            </div>
            <div class="form-group text-center">
                <div class="btn btn-error btn--cancel">
                    Đóng
                </div>
            </div>
        </div>
    </form>
    @*-------------------confirm---------------------*@

    <form class="form" id="confirmForm" method="post">
        <div class="form-container--small">
            <h1 class="form-heading">Thông báo</h1>
            <span>
                Bạn chắc chắn muốn <strong style="font-weight: bold; color: #ce1b28;">thực tập </strong>tại <strong style="font-weight: bold; color: #ce1b28;">doanh nghiệp </strong>
                này không?
            </span>
            <input name="ID" id="id" class="form-input" autocomplete="off" type="hidden" />
            <input name="Student_Email" id="Email" class="form-input" autocomplete="off" type="hidden" />
            <input name="Semester_ID" id="Semester_ID" class="form-input" autocomplete="off" type="hidden" />
            <input name="Mentor_Email" id="Email_Mentor" class="form-input" autocomplete="off" type="hidden" />
            <input name="MentorPoint" id="MentorPoint" class="form-input" autocomplete="off" type="hidden" />
            <input name="MentorComment" id="MentorComment" class="form-input" autocomplete="off" type="hidden" />
            <input name="Business_ID" id="Business_ID" class="form-input" autocomplete="off" type="hidden" />
            <input name="BusinessPoint" id="BusinessPoint" class="form-input" autocomplete="off" type="hidden" />
            <input name="BusinessComment" id="BusinessComment" class="form-input" autocomplete="off" type="hidden" />
            <input name="InternshipTopic_ID" id="position_id" class="form-input" autocomplete="off" type="hidden" />
            <input name="Status" id="Status" class="form-input" autocomplete="off" type="hidden" />
            <div class="form-group text-center">
                <div class="btn btn-error btn--cancel">
                    Hủy
                </div>
                <button class="btn btn-success btn--confirm" id="btn--update">
                    Xác Nhận
                </button>
            </div>
        </div>
    </form>


</main>
@section Scripts {
    <script>
        $(function () {
            var url = "@Url.Action("getDataList", "InternshipResults")"
            "use strict";
            (dataTable = $("#table1").DataTable({
                ajax: {
                    url: url,
                    type: "GET",
                    dataType: "json",
                    dataSrc: "",
                    /*success: function (res) {
                        console.log(res)
                    }*/
                },
                deferRender: !0,
                columns: [
                    { data: null },
                    { data: "BusinessName" },
                    { data: "Position" },
                    { data: "status" },
                    {
                        data: "ID",
                        render: function (t, e, a) {
                            const test = (a.status == "Chờ Xác Nhận") ?
                                `<a href="@Url.Action("Details", "InternshipResults")/${t}" id="business_detail" class="business_confirm">
                                <div class="btn btn-success">
                                   <i class="btn-icon btn-success fal fa-check-circle"></i>

                                </div>
                                </a>`
                                :``

                            return (
                                `
                                <a href="@Url.Action("Details", "InternshipResults")/${t}" id="business_detail" class="business_detail">
                                <div class="btn btn-update">
                                   
                                    <i class="btn-icon btn-icon--detail fal fa-info-circle"></i>

                                </div>
                                </a>
                                ${test}
                                `
                            );
                        },
                    },
                ],
            }))
            // Create Index column datatable
            dataTable.on("draw.dt", function () {
                dataTable.column(0, { search: "applied", order: "applied" }).nodes().each(function (cell, i) {
                    cell.innerHTML = i + 1;
                });
            });

        });
        $('#table1').on('click', '.business_detail', function (e) {
            e.preventDefault()
            const form = document.getElementById('updateForm');
            form.classList.add('is-appear');
            const url = $(this).attr('href');
            $.ajax({
                url: url,
                type: "get",
                dataType: 'json',
                success: function (res) {
                    console.log(res)

                    $('#ID').val(res[0].ID)
                    $('#email').val(res[0].Email)
                    $('#semester_ID').val(res[0].Semester_ID)
                    $('#email_Mentor').val(res[0].Email_Mentor)
                    $('#mentorPoint').val(res[0].MentorPoint)
                    $('#mentorComment').val(res[0].MentorComment)
                    $('#business_ID').val(res[0].Business_ID)
                    $('#businessname').val(res[0].Businessname)
                    $('#businessPoint').val(res[0].BusinessPoint)
                    $('#businessComment').val(res[0].BusinessComment)
                    $('#Position').val(res[0].Position)
                    $('#status').val(res[0].status)
                }
            })
        })
        $('#table1').on('click', '.business_confirm', function (e) {
            e.preventDefault()
            const form = document.getElementById('confirmForm');
            form.classList.add('is-appear');
            const url = $(this).attr('href');
            $.ajax({
                url: url,
                type: "get",
                dataType: 'json',
                success: function (res) {
                    console.log(res)
                    const actionUrl = `@Url.Action("Edit", "InternshipResults")` + `/${res[0].ID}`
                    $('#id').val(res[0].ID)
                    $('#Email').val(res[0].Email)
                    $('#Semester_ID').val(res[0].Semester_ID)
                    $('#Email_Mentor').val(res[0].Email_Mentor)
                    $('#MentorPoint').val(res[0].MentorPoint)
                    $('#MentorComment').val(res[0].MentorComment)
                    $('#Business_ID').val(res[0].Business_ID)
                    $('#Businessname').val(res[0].Businessname)
                    $('#BusinessPoint').val(res[0].BusinessPoint)
                    $('#BusinessComment').val(res[0].BusinessComment)
                    $('#position_id').val(res[0].Position_ID)
                    $('#Status').val(res[0].status)
                    $('#confirmForm').attr('action', `${actionUrl}`)
                }
            })
        })
        $('.btn--cancel').on('click', function () {
            $('#updateForm').removeClass('is-appear')
        })
        $('#btn--cancel').on('click', function () {
            $('#updateForm').removeClass('is-appear')
        })
        $('.btn--cancel').on('click', function () {
            $('#confirmForm').removeClass('is-appear')
        })
    </script>
}

