@model IEnumerable<BusinessConnectManagement.Models.InternshipResult>

@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<section class="list">
    <h1 class="list-heading">DANH SÁCH SINH VIÊN HƯỚNG DẪN</h1>
    @if (TempData != null)
    {
        @Html.Raw(@TempData["AlertMessage"])
    }
    <div class="row">
        <div class="rg_status"></div>
        <label id="nameLabel1">Lọc:</label>
    </div>
    <div class="list-table">
        <table id="table_listData" class="display">
            <thead>
                <tr>
                    <th></th>
                    <th>Họ và Tên</th>
                    <th>SĐT</th>
                    <th>Doanh Nghiệp</th>
                    <th width="333px">Vị Trí</th>
                    <th>Trạng thái</th>
                    <th>Chức Năng</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</section>
@*-------------------------detail--------------------------------*@
<form class="form" id="updateForm" method="post">
    <div class="form-container">
        <h1 class="form-heading">Thông Tin Sinh Viên Hướng Dẫn</h1>
        <div class="form-row">
            <div class="form-column">
                <div class="form-group">
                    <label for="Username" class="form-label">Họ và tên</label>
                    <input class="form-input" id="name" autocomplete="off" disabled />
                </div>
                <div class="form-group">
                    <label for="BusinessName" class="form-label">Email</label>
                    <input class="form-input" id="email" autocomplete="off" disabled />
                </div>
                <div class="form-group">
                    <label for="status" class="form-label">Chuyên Nghành</label>
                    <input class="form-input" id="major" autocomplete="off" disabled />
                </div>
                <div class="form-group">
                    <label for="Website" class="form-label">Tên Doanh Nghiệp</label>
                    <input type="text" id="businessname" class="form-input" autocomplete="off" / disabled>
                </div>
            </div>
            <div class="form-column">
                <div class="form-group">
                    <label for="Password" class="form-label">MSSV</label>
                    <input type="text" id="mssv" class="form-input" autocomplete="off" disabled />
                </div>
                <div class="form-group">
                    <label for="Address" class="form-label">SĐT</label>
                    <input type="text" id="phone" class="form-input" autocomplete="off" disabled />
                </div>

                <div class="form-group">
                    <label for="BusinessPhone" class="form-label">Vị trí  thực tập</label>
                    <input type="text" id="position" class="form-input" autocomplete="off" disabled />
                </div>
                <div class="form-group">
                    <label for="Address" class="form-label">Email Doanh Nghiệp</label>
                    <input type="text" id="businessmail" class="form-input" autocomplete="off" disabled />
                </div>
            </div>
        </div>

        <div class="form-group">
            <a class="btn btn--confirm" id="btn--cancel">
                Xác Nhận
            </a>

        </div>
    </div>
</form>
@*---------------------------------update-----------------------------*@
<form class="form" id="updateInternForm" method="post">
    <div class="form-container--small">
        <h1 class="form-heading">Đánh giá sinh viên thực tập</h1>
        <div class="form-group">
            <label for="Username" class="form-label">Chấm điểm</label>
            <input class="form-input" id="mentorpoint" name="MentorPoint" type="number" autocomplete="off" />
        </div>
        <div class="form-group">
            <label for="BusinessName" class="form-label">Nhận xét</label>
            <textarea class="form-input" id="mentorcomment" name="MentorComment" autocomplete="off"></textarea>
        </div>
        <input class="form-input" id="ID" name="ID" autocomplete="off" hidden />
        <input class="form-input" id="Email" name="Student_Email" autocomplete="off" hidden />
        <input class="form-input" id="sem_id" name="Semester_ID" autocomplete="off" hidden />
        <input class="form-input" id="mentor_email" name="Mentor_Email" autocomplete="off" hidden />
        <input class="form-input" id="business_id" name="Business_ID" autocomplete="off" hidden />
        <input class="form-input" id="businesspoint" name="BusinessPoint" autocomplete="off" hidden />
        <input class="form-input" id="businesscomment" name="BusinessComment" autocomplete="off" hidden />
        <input class="form-input" id="position_id" name="InternshipTopic_ID" autocomplete="off" hidden />
        <input class="form-input" id="status" name="Status" autocomplete="off" hidden />
        <div class="form-group">
            <a class="btn btn--cancel">
                Hủy
            </a>
            <button class="btn btn--confirm" id="btn--cancel" type="submit">
                Xác Nhận
            </button>

        </div>
    </div>
</form>
@section Scripts {

    <script type="text/javascript">
        $(function () {
          var url = "@Url.Action("listDataIntern", "InternshipResultsMentor")"
            "use strict";
             (dataTable = $("#table_listData").DataTable({
                ajax: {
                     url: '/InternshipResultsMentor/getDataList',
                    type: "GET",
                    dataType: "json",
                     dataSrc: ""
                },
                deferRender: !0,
                 columns: [
                    { data: null },
                    { data: "name" },
                    { data: "phone" },
                    { data: "business" },
                    { data: "position" },
                    {data: "status"},
                    {
                        data: "id",
                        render: function (t, e, a) {
                            return (
                                `
                                    <a href="@Url.Action("Details/", "InternshipResultsMentor")${t}" id="business_detail" class="business_detail">
                                        <div class="btn btn--detail">
                                            <i class="btn-icon btn-icon--detail fal fa-info-circle"></i>
                                        </div>
                                    </a>
                                    <a href="@Url.Action("Details/", "InternshipResultsMentor")${t}" id="business_detail" class="business_update">
                                         <div class="btn btn--update">
                                    <i class="btn-icon btn-icon--edit fal fa-edit"></i>
                                </div>
                                    </a>
                                `
                            );
                        },
                    },
                ],
                 initComplete: function () {
                     this.api()
                         .columns(3)
                         .every(function () {
                             var t = this,
                                 e = $(
                                     '<select id="UserType" style="margin-right: 8px;border: 1px solid #aaa;border-radius: 3px;padding: 5px;background-color: transparent; margin-left: 3px;" class="form-select text-capitalize mb-md-0 mb-2xx"><option value="">---- Chọn Doanh Nghiệp Để Lọc ----</option></select>'
                                 )
                                     .prependTo("#table_listData_filter")
                                     .on("change", function () {
                                         var e = $.fn.dataTable.util.escapeRegex($(this).val());
                                         t.search(e ? "^" + e + "$" : "", !0, !1).draw();
                                     });
                             t.data()
                                 .unique()
                                 .sort()
                                 .each(function (t, a) {
                                     t &&
                                         e.append(
                                             '<option value="' +
                                             t +
                                             '" class="text-capitalize">' +
                                             t +
                                             "</option>"
                                         );
                                 });
                         })
                 }
            })
            )
            dataTable.on("draw.dt", function () {
                dataTable.column(0, { search: "applied", order: "applied" }).nodes().each(function (cell, i) {
                    cell.innerHTML = i + 1;
                });
            });
         });
        $('#table_listData').on('click', '.business_detail', function (e) {
            e.preventDefault()
            const form = document.getElementById('updateForm');
            form.classList.add('is-appear');
            const url = $(this).attr('href');
            $.ajax({
                url: url,
                type: "get",
                dataType: 'json',
                success: function (res) {
                    console.log(res)
                    $('#id').val(res[0].id)
                    $('#name').val(res[0].name)
                    $('#mssv').val(res[0].mssv)
                    $('#email').val(res[0].email)
                    $('#major').val(res[0].major)
                    $('#phone').val(res[0].phone)
                    $('#position').val(res[0].position)
                    $('#businessname').val(res[0].businessname)
                    $('#businessmail').val(res[0].businessmail)

                }
            })
        })
        $('#table_listData').on('click', '.business_update', function (e) {
            e.preventDefault()
            const form = document.getElementById('updateInternForm');
            form.classList.add('is-appear');
            const url = $(this).attr('href');
            $.ajax({
                url: url,
                type: "get",
                dataType: 'json',
                success: function (res) {
                    console.log(res)
                    const actionUrl = `@Url.Action("Edit", "InternshipResultsMentor")` + `/${res[0].id}`
                    $('#ID').val(res[0].id)
                    $('#name').val(res[0].name)
                    $('#mssv').val(res[0].mssv)
                    $('#Email').val(res[0].email)
                    $('#major').val(res[0].major)
                    $('#phone').val(res[0].phone)
                    $('#position').val(res[0].position)
                    $('#businessname').val(res[0].businessname)
                    $('#businessmail').val(res[0].businessmail)
                    $('#sem_id').val(res[0].sem_id)
                    $('#mentor_email').val(res[0].mentor_email)
                    $('#mentorpoint').val(res[0].mentorpoint)
                    $('#mentorcomment').val(res[0].mentorcomment)
                    $('#business_id').val(res[0].business_id)
                    $('#businesspoint').val(res[0].businesspoint)
                    $('#businesscomment').val(res[0].businesscomment)
                    $('#position_id').val(res[0].position_id)
                    $('#status').val(res[0].status)
                    $('#updateInternForm').attr('action', `${actionUrl}`)
                }
            })
        })
        $('#btn--cancel').on('click', function () {
            $('#updateForm').removeClass('is-appear')
        })
        $('.btn--cancel').on('click', function () {
            $('#updateInternForm').removeClass('is-appear')
        })
    </script>
    <script>
        $(document).ready(function () {
            $.validator.addMethod("blank", function (value, element) {
                return (!/^\s*$/.test(value));
            }, "Vui lòng nhập điểm đánh giá.");
            /*--------------------------update---------------*/
            $("#updateInternForm").validate();
            // cái này là on blur nè
            $("#updateInternForm input, #updateInternForm input").on("blur", function () {
                $(this).valid();
            });

            // cái này là on change nè
            $("#updateInternForm input, #updateInternForm input").on("change", function () {
                $(this).removeClass("error");
            });
        });
        $("#updateInternForm").validate({
            rules: {
                MentorPoint: {
                    required: true,
                    digits: true,
                    min: 0,
                    max: 10
                   
                }
            },
            messages: {
                MentorPoint: {
                    required: "Vui lòng nhập điểm đánh giá.",
                    digits: "Điểm đánh giá chỉ bao gồm các kí tự số.",
                    min: "Điểm đánh giá từ 0 đến 10",
                    max: "Điểm đánh giá từ 0 đến 10",
                }
            }
        });

    </script>
}